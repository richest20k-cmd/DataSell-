<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="/css/responsive.css">
    <title>Admin Login - DataSell</title>
    <!-- Bootstrap, FontAwesome, SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"/>
    <style>
:root {
    --primary: #2563eb;
    --primary-light: #3b82f6;
    --text: #153062;
    --card-bg: #fff;
    --input-bg: #e3ecfb;
    --border: #b2cdf7;
    --radius: 14px;
    --shadow: 0 8px 18px rgba(37,99,235,0.09),0 2px 10px rgba(59,130,246,.08);
    --transition: all .28s cubic-bezier(.4,0,.2,1);
}
body.admin-login-body {
    background: linear-gradient(127deg, var(--primary) 0%, var(--primary-light) 91%);
    min-height: 100vh; display: flex;
    align-items: center; justify-content: center;
    font-family: 'Segoe UI',system-ui,sans-serif;
    color: var(--text); padding: 0;
}
.login-container {
    width: 95%; max-width: 420px;
}
.login-card {
    background: var(--card-bg);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 2.5rem 2rem;
    transition: var(--transition);
    margin: 0 auto;
}
.login-header {
    text-align: center; margin-bottom: 2rem;
}
.login-header h2 {
    font-size: 2.1rem; font-weight: 700;
    color: var(--primary);
    letter-spacing: .5px;
}
.login-header p {
    color: var(--text); opacity: .75;
    font-size: 1.06rem; margin-bottom: .7rem;
}
.input-group-text {
    background: var(--input-bg);
    border: 1px solid var(--border); border-right: none;
    color: var(--primary); border-radius:8px 0 0 8px;
}
.form-control {
    border: 1px solid var(--border); border-left:none; padding: .75rem;
    background: var(--input-bg); font-size: 1rem; border-radius:0 8px 8px 0;
    transition: var(--transition);
}
.form-label {
    font-weight:500; color: var(--primary); font-size:.94rem;
}
.login-btn {
    background: linear-gradient(135deg,var(--primary),var(--primary-light));
    color: #fff; border-radius: 8px;
    border:none; font-weight:600;
    width:100%; padding:.75rem; font-size:1.04rem;
    margin-top:.8rem; transition:var(--transition);
    display: flex; align-items: center; justify-content: center; gap: 0.5rem;
}
.login-btn:disabled {opacity:.7; cursor:not-allowed;}
.login-btn:hover:not(:disabled) {box-shadow:0 2px 8px #2563eb30;}
.login-footer {
    text-align: center; margin-top: 2rem; border-top: 1px solid var(--border); padding-top:1rem;
}
.login-footer a {
    color: var(--primary); font-weight:500; text-decoration: none;
    font-size: .97rem; transition: var(--transition);
}
.login-footer a:hover { color: var(--primary-light);}
@media (max-width: 576px) {
    .login-card { padding: 1.5rem 1rem; }
    .login-header h2 { font-size: 1.45rem;}
}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-auth-compat.js"></script>
</head>
<body class="admin-login-body">
    <div class="login-container">
        <div class="login-card" id="cardBox">
            <div class="login-header">
                <i class="fa-solid fa-user-shield fa-2x mb-2" style="color:var(--primary);"></i>
                <h2>DataSell Admin</h2>
                <p>Sign in to your admin account</p>
            </div>
            <form id="adminLoginForm" autocomplete="on">
                <div class="mb-3">
                    <label class="form-label" for="email">Email</label>
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="fa-solid fa-envelope"></i>
                        </span>
                        <input type="email" class="form-control" id="email" 
                            placeholder="admin@example.com" required autocomplete="username">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label" for="password">Password</label>
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="fa-solid fa-lock"></i>
                        </span>
                        <input type="password" class="form-control" id="password" 
                            placeholder="Your password" required autocomplete="current-password">
                    </div>
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="remember" name="remember" checked>
                    <label class="form-check-label" for="remember">Remember me</label>
                </div>
                <button type="submit" class="login-btn" id="submitBTN">
                    <i class="fa-solid fa-sign-in-alt"></i>Sign In
                </button>
            </form>
            <div class="login-footer">
                <a href="/" aria-label="Back to Main">
                    <i class="fa-solid fa-arrow-left"></i> Back to Main Site
                </a>
            </div>
        </div>
    </div>
<script>
    // Firebase config from your .env
    const firebaseConfig = {
        apiKey: "AIzaSyDOwZzQ4b3uNQzfFw6X3dfPEBuJFC7ZZyQ",
        authDomain: "datasell-a3f57.firebaseapp.com",
        databaseURL: "https://datasell-a3f57-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "datasell-a3f57",
        storageBucket: "datasell-a3f57.firebasestorage.app",
        messagingSenderId: "717867799921",
        appId: "1:717867799921:web:2a0c6e675dd3c598e012d0"
    };
    firebase.initializeApp(firebaseConfig);

    document.getElementById('adminLoginForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        const remember = !!document.getElementById('remember').checked;
        const submitBtn = document.getElementById('submitBTN');

        // Enforce 'Remember me' checkbox if server requires it
        if (!remember) {
            Swal.fire({
                icon: 'warning',
                title: 'Please check "Remember me"',
                text: 'This application requires you to enable Remember me to sign in.',
            });
            return;
        }

        submitBtn.disabled = true;
        submitBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Signing In...`;

        try {
            // Send login POST request to backend; include credentials so session cookie is set
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                credentials: 'include',
                body: JSON.stringify({ email, password, remember })
            });

            let data;
            try { data = await response.json(); } catch (err) { data = { success: false, error: 'Unexpected server response.' }; }

            if (response.ok && data && data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Welcome to DataSell!',
                    text: 'Redirecting to dashboard...',
                    timer: 1200,
                    showConfirmButton: false
                });
                setTimeout(() => { window.location.href = '/admin'; }, 1000);
            } else {
                const message = (data && data.error) ? data.error : (response.status ? `Login failed (${response.status})` : 'Invalid credentials.');
                Swal.fire({
                    icon: 'error',
                    title: 'Login Failed',
                    text: message,
                });
            }
        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'Network Error',
                text: 'Could not connect. Please try again.',
            });
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = `<i class="fa-solid fa-sign-in-alt"></i>Sign In`;
        }
    });

    // Enter moves focus / submits as needed
    document.getElementById('email').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            document.getElementById('password').focus();
        }
    });
    document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            document.getElementById('adminLoginForm').dispatchEvent(new Event('submit'));
        }
    });
</script>
</body>
</html>